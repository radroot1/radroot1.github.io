<html>
<head>
<title>Texthooker</title>
<style type="text/css">

body {
	background-color: #202020;
	color: #BCBCBC;
}

.container {
	position:fixed;
	top:3px;
	right:5px;
	display:inline-block;
}

#counter {
	background-color:rgba(25,25,25,0.8);
	color:#9d9d9d;
	font-size:.4em;
	line-height:100%;
	float:left;
	padding-left:8px;
	padding-right:8px;
	padding-top:5px;
	padding-bottom:5px;
}

#remove_button {
	background-color:rgba(25,25,25,0.8);
	color:#9d9d9d;
	font-size:.4em;
	line-height:100%;
	float:right;
	margin-right:10px;
	padding-left:8px;
	padding-right:8px;
	padding-top:5px;
	padding-bottom:5px;
	cursor:pointer;
	cursor:hand;
}

</style>
</head>
<body>



<div class="container">
	<div id="remove_button" title="Remove last line">x</div>
	<div id="counter" title="No. of characters / No. of lines">0 / 0</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

<script>

$(document).ready(function(){
let oldlines = 0;
let chars = 0;
document.addEventListener("DOMNodeInserted", function () {
  let lines = document.getElementsByTagName('p').length;
  let isnew = lines - oldlines;
  if ( isnew > 0 ){
	  let i=lines-1
	  let newEl = document.getElementsByTagName('p')[i];
	  let newline = newEl.innerHTML;
	  if(newline.indexOf('. ') === -1){
		newEl.innerHTML = newline + '. '
	  }
  	  let linechars = newline.length;
  	  newchars = chars + linechars;
	  let charsdisp = newchars.toLocaleString();
	  let linesdisp = lines.toLocaleString();
	  jQuery('#counter').text(charsdisp+' / '+linesdisp);
	  oldlines = lines;
	  chars = newchars;
  	  let LEEWAY = 200;

  	  let b = document.body;
  	  let offset = b.scrollHeight - b.offsetHeight;
  	  let scrollPos = (b.scrollTop+offset);
  	  let scrollBottom = (b.scrollHeight - (b.clientHeight+offset));
  	  if (scrollPos >= scrollBottom - LEEWAY) {
 	     window.scrollTo(0,document.body.scrollHeight);
 	  }
  
  }
  
}, false);
document.getElementById("remove_button").addEventListener("click", function() {
	let remove_lines = document.getElementsByTagName('p').length;
	if ( remove_lines > 0 ){
		let q = remove_lines - 1;
		let last = document.getElementsByTagName('p')[q].innerHTML;
  	    let lastlen = last.length;
		$('body').children('p:last').remove();
   	    let newch = chars - lastlen;
   	    let newchdisp = newch.toLocaleString();
 		let newl = oldlines - 1;
 		let newldisp = newl.toLocaleString();
		jQuery('#counter').text(newchdisp+' / '+newldisp);
		chars = newch;
		oldlines = newl;
	}
});
});
</script>
</body>
</html>